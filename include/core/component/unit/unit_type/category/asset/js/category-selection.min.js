/* Category Selection 1.1.1 */
(function($){var aCaches=[];var bProcessing=!1;var sCurrentURL='';var bWarnedAddingCategories=!1;var oSelectArrow;var bShowArrows=!0;$(document).ready(function(){handleGuidingArrows();handleCategoryList(aalCategorySelection.rootURL);handleExistentCategoryItems();handleButton_AddCategory();handleButton_AddExcludingCategory();handleButton_RemoveChecked();debugLog('debug info: ',aalCategorySelection.debug);delete aalCategorySelection.debug;debugLog('arguments: ',aalCategorySelection)});$(document).on("aalUnitPreview",{},renderUnitPreview);function handleGuidingArrows(){bShowArrows=parseInt(aalCategorySelection.postID)?!1:!0;oSelectArrow=$('#arrow-select');oSelectArrow.detach()}
function ___setArrows(){if(!bShowArrows){return}
var _bCategoriesAdded=$('#selected-categories').find('input[tupe=checkbox]').length?!0:!1;if(_bCategoriesAdded){$('#arrow-create').show();oSelectArrow.hide();$('#arrow-add').show();return}
if(aalCategorySelection.rootURL===sCurrentURL){$('#category-list').prepend(oSelectArrow.show());$('#arrow-add').hide();return}
oSelectArrow.hide();$('#arrow-add').show()}
function handleButton_RemoveChecked(){$('#button-remove-checked').on('click',function(event){event.preventDefault();var _oCheckedItems=$('#selected-categories').find('input:checked');if(!_oCheckedItems.length){alert(aalCategorySelection.translation.category_not_selected);return!1}
___removeSelectedCategories(_oCheckedItems)})}
function ___removeSelectedCategories(oItems){oItems.closest('.added-category, .excluding-category').remove();var _oAddedCategories=$('#added-categories');if(!_oAddedCategories.find('.added-category').length){_oAddedCategories.find('.no-categories-added').show()}
var _oExcludingCategories=$('#excluding-categories');if(!_oExcludingCategories.find('.excluding-category').length){_oExcludingCategories.find('.no-categories-added').show()}
if(!$('#selected-categories').find('input[type=checkbox]').length){$('#button-save-unit').attr('disabled','disabled');if(bShowArrows){$('#arrow-create').hide();$('#arrow-add').show()}}}
function handleButton_AddExcludingCategory(){$('#button-add-excluding-category').on('click',function(event){event.preventDefault();if('undefined'===typeof sCurrentURL){return}
if('undefined'===typeof aCaches[sCurrentURL]){return}
var _oCache=aCaches[sCurrentURL];var _sFor=_oCache.checkbox_added.find('label').attr('for');var _oDuplicate=$('#excluding-categories').find('label[for='+_sFor+']');if(_oDuplicate.length){alert(aalCategorySelection.translation.already_added);return!1}
var _oDuplicate=$('#added-categories').find('label[for='+_sFor+']');if(_oDuplicate.length){___removeSelectedCategories(_oDuplicate)}
___addCategory($('#excluding-categories'),_oCache.checkbox_excluded);return!1})}
function handleButton_AddCategory(){$('#button-add-category').on('click',function(event){event.preventDefault();if('undefined'===typeof sCurrentURL){return}
if('undefined'===typeof aCaches[sCurrentURL]){return}
var _oCache=aCaches[sCurrentURL];var _sFor=_oCache.checkbox_added.find('label').attr('for');var _oDuplicate=$('#added-categories').find('label[for='+_sFor+']');if(_oDuplicate.length){alert(aalCategorySelection.translation.already_added);return!1}
var _oDuplicate=$('#excluding-categories').find('label[for='+_sFor+']');if(_oDuplicate.length){___removeSelectedCategories(_oDuplicate)}
___addCategory($('#added-categories'),_oCache.checkbox_added);return!1})}
function ___addCategory(oContainer,oInsert){oContainer.find('.no-categories-added').hide();var _sFor=oInsert.find('label').attr('for');if(oContainer.find('label[for='+_sFor+']').length){return}
var _iMaxNumCat=parseInt(aalCategorySelection.maxNumberOfCategories);var _iCurrentAdded=oContainer.find('input[type=checkbox]').length;if(_iCurrentAdded===_iMaxNumCat&&!bWarnedAddingCategories){bWarnedAddingCategories=!0;alert(aalCategorySelection.translation.too_many_categories)}
oInsert.find('input[type=checkbox]').attr("checked",!1);oInsert.find('a').off('click').on('click',___handleCategoryLinkEvents);oContainer.append(oInsert);$('#button-remove-checked').removeAttr('disabled');$('#button-save-unit').removeAttr('disabled');if(bShowArrows){$('#arrow-create').show();$('#arrow-add, #arrow-select').hide()}}
function handleExistentCategoryItems(){var _oContainers=$('#added-categories, #excluding-categories');_oContainers.find('a').on('click',___handleCategoryLinkEvents)}
function handleCategoryList(sURL,bReload){if(bProcessing){return}
sCurrentURL=sURL;if('undefined'!==typeof aCaches[sURL]){___renderOutputs(sURL,aCaches[sURL]);$(document).trigger("aalUnitPreview",[sURL]);return}
var _oSpinner=$('<span class="ajax-spinner"><img src="'+aalCategorySelection.spinnerURL+'" alt="Spinner" /></span>');$('#category-select-title').append(_oSpinner);bProcessing=!0;$.ajax({type:'post',dataType:'json',url:aalCategorySelection.ajaxURL,data:{action:aalCategorySelection.action_hook_suffix_category_list,aal_nonce:aalCategorySelection.nonce,transientID:aalCategorySelection.transientID,postID:aalCategorySelection.postID,selected_url:sURL,reload:(typeof bReload!=='undefined'&&bReload)?1:0,enableWebPageDumper:$('input[type="checkbox"]#enable-web-page-dumper').is(':checked')?1:0,},success:function(response){debugLog('response (category list)',response);if(!response.success){$('.now-loading-category-list').replaceWith('');$('#category-select-breadcrumb .now-loading-breadcrumb').remove();$('#category-preview .now-loading-category-preview').remove();$('.response-error').remove();$('#category-select-breadcrumb').after('<div class="response-error">'+response.result+'</div>');$('.button-reload').on('click',function(event){event.preventDefault();handleCategoryList(sURL,!0);return!1});return}
___renderOutputs(sURL,{'breadcrumb':$('<span>'+response.result.breadcrumb+'</span>'),'category_list':$(response.result.category_list),'selected_url':response.result.selected_url,'checkbox_added':$('<p class="added-category">'+response.result.checkbox_added+'</p>'),'checkbox_excluded':$('<p class="excluding-category">'+response.result.checkbox_excluded+'</p>'),'category_preview':$('<div>'+response.result.category_preview+'</div>'),});$('.response-error').remove()},error:function(response){console.log('error',response);$('.now-loading-breadcrumb').html('<div class="response-error"><p>'+response.responseText+'</p></div>')},complete:function(){_oSpinner.remove();bProcessing=!1}});$(document).trigger("aalUnitPreview",[sURL])}
function ___renderOutputs(sURL,oResponse){$('#category-select-breadcrumb').html(oResponse.breadcrumb).append('<span id="current-url" class="hidden">'+sURL+'</span>');oResponse.category_list.find('script').remove();$('#category-list').html(oResponse.category_list);$('#category-preview').html(oResponse.category_preview);if('undefined'===typeof aCaches[sURL]){aCaches[sURL]=oResponse}
oResponse.category_list.find('a').off('click').on('click',___handleCategoryLinkEvents);oResponse.checkbox_added.find('a').off('click').on('click',___handleCategoryLinkEvents);oResponse.checkbox_excluded.find('a').off('click').on('click',___handleCategoryLinkEvents);$('#button-add-category').removeAttr('disabled');$('#button-add-excluding-category').attr('disabled','disabled');$('#selected-categories').find('label').each(function(iIndex){if(-1===oResponse.breadcrumb.text().indexOf($(this).text())){return!0}
$('#button-add-excluding-category').removeAttr('disabled');return!1});___setArrows()}
function ___handleCategoryLinkEvents(event){event.preventDefault();var _oCheckbox=$(this).parent().find('input[type=checkbox]')
if(_oCheckbox.length){_oCheckbox.attr('checked',!_oCheckbox.attr('checked'))}
var _bIsRoot='category-list'===$(this).parent().parent().parent().attr('id');var _sURL=_bIsRoot?aalCategorySelection.rootURL:$(this).attr('data-url');handleCategoryList(_sURL);return!1}
function renderUnitPreview(event,sURL){var _oSpinner=$('<span class="ajax-spinner"><img src="'+aalCategorySelection.spinnerURL+'" alt="Spinner" /></span>');$('#unit-preview-title').append(_oSpinner);$.ajax({type:'post',dataType:'json',url:aalCategorySelection.ajaxURL,data:{action:aalCategorySelection.action_hook_suffix_unit_preview,aal_nonce:aalCategorySelection.nonce,transientID:aalCategorySelection.transientID,postID:aalCategorySelection.postID,urls_added:___getURLsAdded(sURL),urls_excluded:___getURLsExcluded(),},success:function(response){debugLog('response (unit preview):',response);if(!response.success){$('#unit-preview').html($('<div class="response-error">'+'<p>'+response.result+'</p>'+'</div>'));return}
if(sURL!==sCurrentURL){return}
$('#unit-preview').html($('<div>'+response.result.unit_preview+'</div>'))},error:function(response){$('#unit-preview').html($('<div class="response-error">'+'<p>'+response.responseText+'</p>'+'</div>'))},complete:function(){_oSpinner.remove()}})}
function ___getURLsAdded(sCurrentlyDisplayingURL){var _aURLs=[sCurrentlyDisplayingURL];$('#added-categories').find('a').each(function(iIndex){_aURLs.push($(this).attr('data-url'))});return _aURLs}
function ___getURLsExcluded(){var _aURLs=[];$('#excluding-categories').find('a').each(function(iIndex){_aURLs.push($(this).attr('data-url'))});return _aURLs}
function debugLog(...args){if(!parseInt(aalCategorySelection.debugMode)){return}
console.log('AAL Category Selection:',...args)}}(jQuery))