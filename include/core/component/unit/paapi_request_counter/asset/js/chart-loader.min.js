/* Chart Loader 1.0.1 */
(function($){var _oCanvasContainer;var _oChartElement;var _oChart;$(document).ready(function(){if('undefined'===typeof aalChartJSLoader){console.log('Amazon Auto Links','Chart Loader','The script dat is not passed.');return;}
if(aalChartJSLoader.debugMode){console.log('Amazon Auto Links','Chart Loader',aalChartJSLoader);}
_oChartElement=$('#'+aalChartJSLoader.chartID);_oChart=getChartCreated(_oChartElement,aalChartJSLoader.logX,aalChartJSLoader.logY,aalChartJSLoader.total);$('.chart_option_update').click(updatedChartOptions);_oCanvasContainer=_oChartElement.parent();$(window).resize(debounce(resizeCanvasContainer));});function updatedChartOptions(event){event.preventDefault();var _isStartTime=$('input.from').val();var _isEndTime=$('input.to').val();var _oThis=$(this);$.ajax({type:"post",dataType:'json',async:true,cache:true,url:aalChartJSLoader.ajaxURL,data:{action:aalChartJSLoader.actionHookSuffix,aal_nonce:aalChartJSLoader.nonce,locale:$('.locales select').val(),startTime:_isStartTime,endTime:_isEndTime,},spinnerImage:$('<img class="aal-spinner" src="'+aalChartJSLoader.spinnerURL+'" />'),beforeSend:function(){this.spinnerImage.css({'vertical-align':'middle','display':'inline-block','height':'auto','margin-left':'0.5em'});_oThis.closest('.amazon-auto-links-input-label-container').append(this.spinnerImage);},success:function(response){if(!response.success){return;}
_oChart.destroy();_oChart=getChartCreated(_oChartElement,response.result.date,response.result.count,response.result.total,);},error:function(response){},complete:function(){$('.aal-spinner').remove();}});return false;}
function resizeCanvasContainer(event){var _iOverlap=_getSideMetaBoxOverlapWidth();if(!_iOverlap){_oChart.canvas.parentNode.style.width='auto';return;}
var _iNewContainerWidth=_oCanvasContainer.width()-(_iOverlap+10);_oCanvasContainer.width(_iNewContainerWidth);}
function _getSideMetaBoxOverlapWidth(){var _oSideMetaBox=$("#side-sortables");if(!_oSideMetaBox.length){return 0;}
var _iScrollLeft=$(window).scrollLeft();var _aOffsetSideMetaBox=_oSideMetaBox.offset();var _iSideMetaBoxPosX=_aOffsetSideMetaBox.left-_iScrollLeft;var _aOffsetCanvasContainer=_oCanvasContainer.offset();var _iCanvasContainerPosX2=_aOffsetCanvasContainer.left+_oCanvasContainer.width()-_iScrollLeft;if(_iSideMetaBoxPosX<480){return 0;}
return _iCanvasContainerPosX2>_iSideMetaBoxPosX?Math.ceil(_iCanvasContainerPosX2-_iSideMetaBoxPosX):0;}
function getChartCreated(oChartElement,aX,aY,iTotal){var _oChartContainer=oChartElement.parent();_oChartContainer.after("<input type='hidden' name='chart-x' value='"+aX.join('|')+"'/>");_oChartContainer.after("<input type='hidden' name='chart-y' value='"+aY.join('|')+"'/>");return new Chart(oChartElement,{"type":"line","data":{"labels":aX,"datasets":[{"label":aalChartJSLoader.labels.counts+' ('+aalChartJSLoader.labels.total+': '+iTotal+')',"data":aY,"fill":false,"borderColor":"rgb(75, 192, 192)","lineTension":0}]},"options":{responsive:true,maintainAspectRatio:true,legend:{display:true,},tooltips:{callbacks:{title:function(tooltipItems,data){return data.labels[tooltipItems[0].index];},label:function(tooltipItem,data){return aalChartJSLoader.labels.count+': '+tooltipItem.yLabel;}}},scales:{xAxes:[{type:'time',time:{unit:'day',displayFormats:{day:'YYYY-MMM-D',},tooltipFormat:'ll',parser:function(utcMoment){return moment(utcMoment).utcOffset(aalChartJSLoader.GMTOffset);}},ticks:{callback:_formatDateLabel,source:'labels'},scaleLabel:{display:true,labelString:aalChartJSLoader.labels.dates}}],yAxes:[{scaleLabel:{display:true,labelString:aalChartJSLoader.labels.counts},ticks:{suggestedMin:0,stepSize:1}}]}}});}
var _sYear=null;var _sMonth=null;function _formatDateLabel(sValue,iIndex,values){if(0===iIndex&&1>=values.length){_sYear=null;_sMonth=null;return sValue;}
var _aDateParts=sValue.split('-');var _sThisYear=_sYear===_aDateParts[0]?'':_aDateParts[0];var _sThisMonth=_sMonth===_aDateParts[1]?'':_aDateParts[1];var _sThisDate=_aDateParts[2];sValue=__getLabelOmittedByLength(sValue,iIndex,values,_sThisYear,_sThisMonth,_sThisDate);if(!sValue){return sValue;}
_sYear=_aDateParts[0];_sMonth=_aDateParts[1];var _sLabel=_sThisYear+' '+_sThisMonth+' '+_sThisDate;return _sLabel.trim();}
function __getLabelOmittedByLength(sValue,iIndex,values,sYear,sMonth,sDate){if(30>values.length){return sValue;}
if(0===iIndex){return sValue;}
if(values.length===iIndex+1){return sValue;}
var _iSpan=Math.round(values.length / 10);if((iIndex%_iSpan)){return'';}
return sValue;}}(jQuery));;