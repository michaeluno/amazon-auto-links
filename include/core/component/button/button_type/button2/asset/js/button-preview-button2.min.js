/* Button2 Button Preview Event Binder 1.0.0 */
(function($){$(document).ready(function(){console.log('AAL Button Preview - Button2',aalButton2ButtonPreviewEventBinder);if('undefined'===typeof aalButton2ButtonPreviewEventBinder){return}
var buttonID='undefined'===typeof aalButton2ButtonPreviewEventBinder.postID?'___button_id___':aalButton2ButtonPreviewEventBinder.postID;var styleKeyButton='.amazon-auto-links-button-'+buttonID;var styleKeyButtonHover=styleKeyButton+':hover';var styleKeyButtonChildren=styleKeyButton+' > *';var styleKeyIconLabel=styleKeyButton+' .button-label';var styleKeyIconBoth=styleKeyButton+' .button-icon';var styleKeyIconLeft=styleKeyButton+' .button-icon-left';var styleKeyIconRight=styleKeyButton+' .button-icon-right';var styleHolder=getDefaultStyleHolder();var previewFrame=$('#button-preview-button2 > iframe').first();var inputs=$('.dynamic-button-field input, .dynamic-button-field select, .dynamic-button-field textarea');var debouncers={};var inputProcessor=getInputProcessor();inputs.on('change input',function(){var _property=$(this).data('property');_property=typeof _property!=='string'?'':_property;var _methodName='undefined'!==typeof inputProcessor[_property]?_property:'_common';if(!_property.length){return}
var _self=$(this);clearTimeout(debouncers[_property+$(this).data('selectorSuffix')]);debouncers[_property+$(this).data('selectorSuffix')]=setTimeout(function(){inputProcessor[_methodName](_self)},100);clearTimeout(debouncers._stylesheet_generator);debouncers._stylesheet_generator=setTimeout(function(){var _style=_getCSSRulesGenerated(sortObject(styleHolder))+'\n'+$('#custom_css__0').val();_setStyleSheetInFramedPage(_style,'button-preview-button2-framed-stylesheet',previewFrame);$('#button_css__0').text(_style);previewFrame[0].contentWindow.postMessage({message:'hi there!',event:'ReloadButtonPreview',nonce:aalButton2ButtonPreviewEventBinder.nonce,},location.protocol+'//'+location.host)},200);function _setStyleSheetInFramedPage(style,attributeID,previewFrame){var _styleSheet=$('<style>',{id:attributeID});_styleSheet.text(style);var _prevSheet=previewFrame.contents().find('#'+attributeID);if(_prevSheet.length>0){_prevSheet.replaceWith(_styleSheet)}else{previewFrame.contents().find('head').first().append(_styleSheet)}}
function _getCSSRulesGenerated(styleHolder){var _extraCSS='';for(var selector in styleHolder){if(!styleHolder.hasOwnProperty(selector)){continue}
_extraCSS+=__getRulesBySelector(selector,styleHolder[selector])}
return _extraCSS.trim();function __getRulesBySelector(selector,ruleset){if($.isEmptyObject(ruleset)){return''}
var _rules=selector+' {\n';for(var prop in ruleset){if(!ruleset.hasOwnProperty(prop)){continue}
_rules+='    '+prop+': '+ruleset[prop]+';\n'}
_rules+='}\n';return _rules}}
function sortObject(obj){return Object.keys(obj).sort().reduce(function(result,key){result[key]=obj[key];return result},{})}});(function(iframe){iframe.on('load',function(){inputProcessor.jqPreviewButtonIconLeft=previewFrame.contents().find('body .button-icon-left');inputProcessor.jqPreviewButtonIconRight=previewFrame.contents().find('body .button-icon-right');inputProcessor.jqPreviewButtonLabel=previewFrame.contents().find('body .button-label').first();clearTimeout(debouncers._iframe_preview_loaded);debouncers._iframe_preview_loaded=setTimeout(function(){triggerInputChanges(inputs)},2000)});if('complete'===iframe[0].contentDocument.readyState){iframe.trigger('load')}})(previewFrame);(function(iframe){if(!window.addEventListener){return}
window.addEventListener('message',function(event){if(event.origin!==location.protocol+'//'+location.host){return}
if('undefined'===typeof event.data.height){return}
iframe.height(event.data.height).css('height',event.data.height+'px')},!1)})(previewFrame);function getInputProcessor(){var inputProcessorBase={'iconLeft':{'jqIconToggle':$('.dynamic-button-field input[type=radio][data-property=_icon_toggle_left]'),'jqIconType':$('.dynamic-button-field input[type=radio][data-property=_icon_image_type_left]'),'jqIconSVGMaskToggle':$('.dynamic-button-field input[type=checkbox][data-property=_icon_svg_mask_toggle_left]'),'jqIconSizeType':$('.dynamic-button-field input[type=radio][data-property=_icon_size_type_left]'),'jqIconSizeConstraint':$('.dynamic-button-field input[type=checkbox][data-property=_icon_size_constraint_left]'),},'iconRight':{'jqIconToggle':$('.dynamic-button-field input[type=radio][data-property=_icon_toggle_right]'),'jqIconType':$('.dynamic-button-field input[type=radio][data-property=_icon_image_type_right]'),'jqIconSVGMaskToggle':$('.dynamic-button-field input[type=checkbox][data-property=_icon_svg_mask_toggle_right]'),'jqIconSizeType':$('.dynamic-button-field input[type=radio][data-property=_icon_size_type_right]'),'jqIconSizeConstraint':$('.dynamic-button-field input[type=checkbox][data-property=_icon_size_constraint_right]'),},'jqFontSizeInput':$('.dynamic-button-field input[type=number][data-property=font-size]'),'jqPreviewButtonIconLeft':undefined,'jqPreviewButtonIconRight':undefined,'jqPreviewButtonLabel':undefined,'lineHeight':1.3,'lastUpdatedLineHeight':0,'isIconEnabled':function(position){return getBoolean(this['icon'+getFirstLetterCapitalized(position.toLowerCase())].jqIconToggle.filter(':checked').val())},'getIconType':function(position){return getBoolean(this['icon'+getFirstLetterCapitalized(position.toLowerCase())].jqIconType.filter(':checked').val())},'getLabelHeight':function(){var _lineHeight=this.getLineHeightProperty();var _fontSize=this.getFontSize();return _fontSize&&_lineHeight?Math.ceil(_fontSize*_lineHeight):Math.ceil(this.jqPreviewButtonLabel.height())},'setLineHeightProperty':function(){if('undefined'===typeof this.jqPreviewButtonLabel){return}
var _interval=1000;if(this.lastUpdatedLineHeight>=(Date.now()-_interval)){return}
this.lastUpdatedLineHeight=Date.now();var _element=this.jqPreviewButtonLabel.get(0);if('undefined'===typeof _element){return}
this.lineHeight=_getLineHeight(_element);function _getLineHeight(el){var temp=document.createElement(el.nodeName),ret;temp.setAttribute("style","margin:0; padding:0; "+"font-family:"+(el.style.fontFamily||"inherit")+"; "+"font-size:10px; "+"display: inline; "+"position:absolute; left:-999em;");temp.innerHTML="A";el.parentNode.appendChild(temp);ret=Math.round((temp.clientHeight/10)*10)/10;temp.parentNode.removeChild(temp);return ret}},'getLineHeightProperty':function(){this.setLineHeightProperty();return this.lineHeight},'getFontSize':function(){return parseInt(this.jqFontSizeInput.val())},'adjustIconHeight':function(rightOrLeft){var _heightLabel=this.getLabelHeight();var _key='left'===rightOrLeft?styleKeyIconLeft:styleKeyIconRight;styleHolder[_key]['min-height']=_heightLabel+'px';styleHolder[_key]['min-width']=_heightLabel+'px'},setDimension:function(self,key,property){var _oField=self.closest('.amazon-auto-links-field');var _valueSize=_oField.find('input').val();if(!_valueSize.length){delete styleHolder[key][property];return}
var _unitSize=_oField.find('select').val();styleHolder[key][property]=_valueSize+_unitSize},'_custom_css':function(self){},'_common':function(self){if(!self.data('property')){return}
var _suffixSelector='undefined'!==typeof self.data('selectorSuffix')&&self.data('selectorSuffix').length?' '+$.trim(self.data('selectorSuffix')):'';var _suffixValue='undefined'!==typeof self.data('suffix')&&self.data('suffix').length?self.data('suffix'):'';if('undefined'===typeof styleHolder[styleKeyButton+_suffixSelector]){styleHolder[styleKeyButton+_suffixSelector]={}}
styleHolder[styleKeyButton+_suffixSelector][self.data('property')]=self.val()+_suffixValue}};var inputProcessorHover={'_hover_scale':function(self){if(self.is(':checked')){styleHolder[styleKeyButtonHover].transform='scale(1.0);';styleHolder[styleKeyButton].transform='scale(0.98)';return}
delete styleHolder[styleKeyButtonHover].transform;delete styleHolder[styleKeyButton].transform},'_hover_brightness':function(self){if(self.is(':checked')){styleHolder[styleKeyButtonHover].filter='alpha(opacity=70)';styleHolder[styleKeyButtonHover].opacity='0.7';return}
delete styleHolder[styleKeyButtonHover].filter;delete styleHolder[styleKeyButtonHover].opacity},};var inputProcessorBox={'_width_toggle':function(self){if(!self.is(':checked')){delete styleHolder[styleKeyButton].width;return}
$("input[type=number][data-property='width']").trigger('change')},'width':function(self){this.setDimension(self,styleKeyButton,self.data('property'))},'_height_toggle':function(self){if(!self.is(':checked')){delete styleHolder[styleKeyButton].height;return}
$("input[type=number][data-property='height']").trigger('change')},'height':function(self){this.setDimension(self,styleKeyButton,self.data('property'))},'_padding_type':function(self){if('all'===self.val()){delete styleHolder[styleKeyButton]['padding-top'];delete styleHolder[styleKeyButton]['padding-right'];delete styleHolder[styleKeyButton]['padding-bottom'];delete styleHolder[styleKeyButton]['padding-left'];$("input[type=number][data-property='padding']").trigger('change');return}
delete styleHolder[styleKeyButton].padding;$("input[type=number][data-property^='padding-']").trigger('change')},};var inputProcessorText={'_text_margin_type':function(self){var _suffixSelector='undefined'!==typeof self.data('selectorSuffix')&&self.data('selectorSuffix').length?' '+$.trim(self.data('selectorSuffix')):'';if('all'===$(self).val()){delete styleHolder[styleKeyButton+_suffixSelector]['margin-top'];delete styleHolder[styleKeyButton+_suffixSelector]['margin-right'];delete styleHolder[styleKeyButton+_suffixSelector]['margin-bottom'];delete styleHolder[styleKeyButton+_suffixSelector]['margin-left'];$("input[type=number][data-property='margin'][data-selector-suffix='"+self.data('selectorSuffix')+"']").trigger('change');return}
delete styleHolder[styleKeyButton+_suffixSelector].margin;$("input[type=number][data-property^='margin-'][data-selector-suffix='"+self.data('selectorSuffix')+"']").trigger('change')},'_button_label':function(self){this.jqPreviewButtonLabel.text($(self).val())},'font-size':function(self){this._common(self);if(this.iconLeft.jqIconSizeConstraint.is(':checked')){if(this.isIconEnabled('left')){this.adjustIconHeight('left')}}
if(this.iconRight.jqIconSizeConstraint.is(':checked')){if(this.isIconEnabled('right')){this.adjustIconHeight('right')}}}};var inputProcessorIconLeft=_getInputProcessorIcon('left',inputProcessorBase);var inputProcessorIconRight=_getInputProcessorIcon('right',inputProcessorBase);return $.extend({},inputProcessorBase,inputProcessorText,inputProcessorIconLeft,inputProcessorIconRight,inputProcessorBox,inputProcessorHover);function _getInputProcessorIcon(position,inputProcessorBase){var _pos=position.toLowerCase();var _styleKeyIcon='left'===_pos?styleKeyIconLeft:styleKeyIconRight;var _iconPos='icon'+getFirstLetterCapitalized(_pos);var _inputProcessorIcon=_getInputProcessorIcon();var _inputProcessorIconSVGFile=_getInputProcessorIconSVGFile();var _inputProcessorIconImageFile=_getInputProcessorIconImageFile();return $.extend({},_inputProcessorIcon,_inputProcessorIconSVGFile,_inputProcessorIconImageFile);function _getInputProcessorIcon(){var _processor={};_processor['_icon_'+_pos+'_margin_type']=function(self){if('all'===$(self).val()){delete styleHolder[_styleKeyIcon]['margin-top'];delete styleHolder[_styleKeyIcon]['margin-right'];delete styleHolder[_styleKeyIcon]['margin-bottom'];delete styleHolder[_styleKeyIcon]['margin-left'];$("input[type=number][data-property='margin'][data-selector-suffix='"+self.data('selectorSuffix')+"']").trigger('change');return}
delete styleHolder[_styleKeyIcon].margin;$("input[type=number][data-property^='margin-'][data-selector-suffix='"+self.data('selectorSuffix')+"']").trigger('change')};_processor['_icon_toggle_'+_pos]=function(self){if(!getBoolean(self.val())){styleHolder[_styleKeyIcon]={};$(self.data('selectors')).hide();return}
triggerInputChanges($('.fields-button-icon-'+_pos+' input, .fields-button-icon-'+_pos+' select').not(self))};_processor['_icon_image_type_'+_pos]=function(self){var _imageTypeHandlers={'svg_file':function(){triggerInputChanges($('.svg-file-'+_pos+' input, .svg-file-'+_pos+' select').not(self))},'image_file':function(){delete styleHolder[_styleKeyIcon]['background-color'];delete styleHolder[_styleKeyIcon]['-webkit-mask-image'];delete styleHolder[_styleKeyIcon]['mask-image'];delete styleHolder[_styleKeyIcon]['-webkit-mask-position'];delete styleHolder[_styleKeyIcon]['mask-position'];delete styleHolder[_styleKeyIcon]['-webkit-mask-repeat'];delete styleHolder[_styleKeyIcon]['mask-repeat'];triggerInputChanges($('.image-file-'+_pos+' input, .image-file-'+_pos+' select').not(self))},'_unknown':function(){console.log('An unknown button icon image type is selected.')}};var _type=self.val();var _methodName='undefined'===typeof _imageTypeHandlers[_type]?'_unknown':_type;_imageTypeHandlers[_methodName]()};_processor['_icon_size_constraint_'+_pos]=function(self){var _thisSection=self.closest('.amazon-auto-links-section');var _associatedFields=_thisSection.find('.dynamic-button-field '+self.data('selectors'));if(self.is(':checked')){this.adjustIconHeight(_pos);this[_iconPos].jqIconSizeType.each(function(){_thisSection.find('.dynamic-button-field '+$(this).data('selectors')).hide()});_associatedFields.hide();return}
_associatedFields.show();this[_iconPos].jqIconSizeType.filter(':checked').trigger('change')};_processor['_icon_size_type_'+_pos]=function(self){if(this[_iconPos].jqIconSizeConstraint.is(':checked')){this[_iconPos].jqIconSizeConstraint.trigger('change');return}
if('all'===self.val()){$('.dynamic-button-field input[type=number][data-property=_icon_size_all_'+_pos+']').first().trigger('change');``}else{$('.dynamic-button-field input[type=number][data-property=_icon_size_each_width_'+_pos+']').trigger('change');$('.dynamic-button-field input[type=number][data-property=_icon_size_each_height_'+_pos+']').trigger('change')}};_processor['_icon_size_all_'+_pos]=function(self){this.setDimension(self,_styleKeyIcon,'min-width');this.setDimension(self,_styleKeyIcon,'min-height')};_processor['_icon_size_each_width_'+_pos]=function(self){this.setDimension(self,_styleKeyIcon,'min-width')};_processor['_icon_size_each_height_'+_pos]=function(self){this.setDimension(self,_styleKeyIcon,'min-height')};return _processor}
function _getInputProcessorIconImageFile(){var _processor={};_processor['_icon_image_file_'+_pos]=function(self){if(!this.isIconEnabled(_pos)){styleHolder[_styleKeyIcon]={};return}
styleHolder[_styleKeyIcon].display='inline-flex';var _url=$(self).val().trim();if(!_url.length){delete styleHolder[_styleKeyIcon]['background-image'];return}
styleHolder[_styleKeyIcon]['background-image']="url('"+_url+"')";styleHolder[_styleKeyIcon]['background-size']='contain';styleHolder[_styleKeyIcon]['background-position']='center';styleHolder[_styleKeyIcon]['background-repeat']='no-repeat';var _heightLabel=Math.ceil(this.jqPreviewButtonLabel.height());styleHolder[_styleKeyIcon]['min-height']=_heightLabel+'px';styleHolder[_styleKeyIcon]['min-width']=_heightLabel+'px'};return _processor}
function _getInputProcessorIconSVGFile(){var _processor={'isSVGMaskEnabled':function(position){return this['icon'+getFirstLetterCapitalized(position)].jqIconSVGMaskToggle.is(':checked')},};_processor['_icon_svg_file_'+_pos]=function(self){if(!this.isIconEnabled(_pos)){styleHolder[_styleKeyIcon]={};return}
if(this.getIconType(_pos)!=='svg_file'){delete styleHolder[_styleKeyIcon]['background-color']}
styleHolder[_styleKeyIcon].display='inline-flex';var _url=$(self).val().trim();if(!_url.length){delete styleHolder[_styleKeyIcon]['-webkit-mask-image'];delete styleHolder[_styleKeyIcon]['mask-image'];delete styleHolder[_styleKeyIcon]['-webkit-mask-position'];delete styleHolder[_styleKeyIcon]['mask-position'];delete styleHolder[_styleKeyIcon]['-webkit-mask-repeat'];delete styleHolder[_styleKeyIcon]['mask-repeat'];return}
var _urlCSS="url('"+_url+"')";if(this.isSVGMaskEnabled(_pos)){delete styleHolder[_styleKeyIcon]['background-image']}else{delete styleHolder[_styleKeyIcon]['background-color'];styleHolder[_styleKeyIcon]['background-image']=_urlCSS}
styleHolder[_styleKeyIcon]['background-size']='contain';styleHolder[_styleKeyIcon]['background-position']='center';styleHolder[_styleKeyIcon]['background-repeat']='no-repeat';styleHolder[_styleKeyIcon]['-webkit-mask-image']=_urlCSS;styleHolder[_styleKeyIcon]['mask-image']=_urlCSS;styleHolder[_styleKeyIcon]['-webkit-mask-position']='center center';styleHolder[_styleKeyIcon]['mask-position']='center center';styleHolder[_styleKeyIcon]['-webkit-mask-repeat']='no-repeat';styleHolder[_styleKeyIcon]['mask-repeat']='no-repeat'};_processor['_icon_svg_mask_toggle_'+_pos]=function(self){if($(self).is(':checked')){delete styleHolder[_styleKeyIcon]['background-image'];$("input[type=text][data-property='_icon_svg_mask_"+_pos+"']").trigger('change');return}
delete styleHolder[_styleKeyIcon]['background-color'];$("input[type=text][data-property='_icon_svg_file_"+_pos+"']").trigger('change')};_processor['_icon_svg_mask_'+_pos]=function(self){styleHolder[_styleKeyIcon]['background-color']=$(self).val()};return _processor}}}
function getDefaultStyleHolder(){var _styleHolder={};_styleHolder[styleKeyButton]={'margin-right':'auto','margin-left':'auto','white-space':'nowrap','text-align':'center','display':'inline-flex','justify-content':'space-around',};_styleHolder[styleKeyButtonChildren]={'align-items':'center','display':'inline-flex','vertical-align':'middle',};_styleHolder[styleKeyIconLabel]={};_styleHolder[styleKeyIconBoth]={'margin-right':'auto','margin-left':'auto','display':'none','height':'auto',};_styleHolder[styleKeyIconLeft]={};_styleHolder[styleKeyIconRight]={};_styleHolder[styleKeyButtonHover]={};return _styleHolder}
function triggerInputChanges(elements){$(elements).not('input[type=radio]:not(:checked)').not('input[data-reveal], select[data-reveal]').trigger('change');$(elements).filter('input[data-reveal], select[data-reveal]').not('input[type=radio]:not(:checked)').trigger('change')}
function getFirstLetterCapitalized(string){return string.charAt(0).toUpperCase()+string.slice(1)}
function getBoolean(string){switch(string.toLowerCase().trim()){case "true":case "yes":case "1":return!0;case "false":case "no":case "0":case null:return!1;default:return Boolean(string)}}})}(jQuery))