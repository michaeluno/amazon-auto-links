(function($){$.fn.aalSurveyTooltip=function(options){if('string'===typeof options){options={content:isHTML(options)?options:"<span>"+options+"</span>"}}
initialize(this,options)};function initialize(target,options){var _this=$(target);var _content=$(target).attr('data-tooltip-content');_content=_content?_content:undefined;options='undefined'===typeof options?{}:options;options=$.extend({},{pointerClass:'amazon-auto-links-tooltip-survey-balloon',width:$(target).data('width')||options.width||340,shown:!1,content:_content,oneOff:!1,autoClose:!0,noArrow:!1,},options);options.pointerClass+=options.noArrow?' no-arrow':'';$(_this).removeClass('no-js');if(options.shown){handleTooltip(target,options)}
var _pointerTooltip=$(_this);if(!options.oneOff){_pointerTooltip.on('mouseover touchend',options,handleTooltipCallback)}}
function handleTooltipCallback(event){handleTooltip(this,event.data)}
function handleTooltip(self,options){var _body=$('body');var _width=options.width;var _content='undefined'!==typeof options.content?$(isHTML(options.content)?options.content:"<span>"+options.content+"</span>"):$(self).find('.amazon-auto-links-tooltip-survey-content').clone();var _offscreen=$(self).offset().left+$(self).width()+_width>_body.offset().left+_body.width();var _options=$.extend(!0,{},options,{pointerWidth:_width,content:function(){return _content.html()},buttons:function(){},close:function(){},},options);_options.pointerClass+=_offscreen?' offscreen':'';$(self).aalPointer(_options).aalPointer('open');var _self=self;if(options.autoClose){handleAutoClose(_self,_content)}else{setTimeout(function(){handleCloseOnEmptySpace(_self,_content,options)},200)}
setTimeout(function(){handleCloseOnMobile(_self,_content)},200)}
function handleCloseOnEmptySpace(self,content,options){var _class=options.pointerClass.split(' ')[0];var _emptySpace=$('body').not('.'+_class);_emptySpace.on('click',':not(.'+_class+')',_closeTooltipOnEmptySpace);function _closeTooltipOnEmptySpace(event){if($(this).closest('.'+_class).length){return}
_emptySpace.off('click',_closeTooltipOnEmptySpace);$(self).aalPointer('close');content.remove()}}
function handleCloseOnMobile(self,content){var _body=$('body');_body.on('touchstart',_closeTooltipMobile);function _closeTooltipMobile(event){_body.off('touchstart',_closeTooltipMobile);$(self).aalPointer('close');content.remove()}}
function handleAutoClose(self,content){$(self).add('.amazon-auto-links-tooltip-survey-balloon').on('mouseleave',function(event){var _selfMouseLeave=this;var _timeoutId=setTimeout(function(){$(self).aalPointer('close');content.remove();$(self).off('mouseleave');$(_selfMouseLeave).off('mouseleave');$(self).off('mouseenter');$(_selfMouseLeave).off('mouseenter')},1000);$(self).data('timeoutId',_timeoutId)});$(self).add('.amazon-auto-links-tooltip-survey-balloon').on('mouseenter',function(){clearTimeout($(self).data('timeoutId'))})}
function isHTML(str){var a=document.createElement('div');a.innerHTML=str;for(var c=a.childNodes,i=c.length;i--;){if(1===c[i].nodeType){return!0}}
return!1}}(jQuery))